<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src/davinci-eight/uniforms/Node.ts - davinci-eight</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../../assets/logo.png" title="davinci-eight"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 2.60.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/AmbientLight.html">AmbientLight</a></li>
                                <li><a href="../classes/ArrowBuilder.html">ArrowBuilder</a></li>
                                <li><a href="../classes/ArrowOptions.html">ArrowOptions</a></li>
                                <li><a href="../classes/AttribMetaInfo.html">AttribMetaInfo</a></li>
                                <li><a href="../classes/AttribMetaInfos.html">AttribMetaInfos</a></li>
                                <li><a href="../classes/AttribProvider.html">AttribProvider</a></li>
                                <li><a href="../classes/BarnGeometry.html">BarnGeometry</a></li>
                                <li><a href="../classes/BoxBuilder.html">BoxBuilder</a></li>
                                <li><a href="../classes/BoxMesh.html">BoxMesh</a></li>
                                <li><a href="../classes/Cartesian1.html">Cartesian1</a></li>
                                <li><a href="../classes/Cartesian2.html">Cartesian2</a></li>
                                <li><a href="../classes/Cartesian3.html">Cartesian3</a></li>
                                <li><a href="../classes/Color.html">Color</a></li>
                                <li><a href="../classes/Color
                WARNING: In many object-oriented designs, types representing values are completely immutable.
                In a graphics library where data changes rapidly and garbage collection might become an issue,
                it is common to use reference types, such as in this design. This mutability can lead to
                difficult bugs because it is hard to reason about where a color may have changed..html">Color
                WARNING: In many object-oriented designs, types representing values are completely immutable.
                In a graphics library where data changes rapidly and garbage collection might become an issue,
                it is common to use reference types, such as in this design. This mutability can lead to
                difficult bugs because it is hard to reason about where a color may have changed.</a></li>
                                <li><a href="../classes/CuboidMesh.html">CuboidMesh</a></li>
                                <li><a href="../classes/CylinderArgs.html">CylinderArgs</a></li>
                                <li><a href="../classes/DefaultUniformProvider.html">DefaultUniformProvider</a></li>
                                <li><a href="../classes/DirectionalLight.html">DirectionalLight</a></li>
                                <li><a href="../classes/Drawable.html">Drawable</a></li>
                                <li><a href="../classes/DrawMode.html">DrawMode</a></li>
                                <li><a href="../classes/ElementArray.html">ElementArray</a></li>
                                <li><a href="../classes/EllipsoidMesh.html">EllipsoidMesh</a></li>
                                <li><a href="../classes/Face3.html">Face3</a></li>
                                <li><a href="../classes/frustum.html">frustum</a></li>
                                <li><a href="../classes/Frustum.html">Frustum</a></li>
                                <li><a href="../classes/Geometry.html">Geometry</a></li>
                                <li><a href="../classes/GeometryAdapter.html">GeometryAdapter</a></li>
                                <li><a href="../classes/KleinBottleGeometry.html">KleinBottleGeometry</a></li>
                                <li><a href="../classes/Line3.html">Line3</a></li>
                                <li><a href="../classes/LocalModel.html">LocalModel</a></li>
                                <li><a href="../classes/Matrix4.html">Matrix4</a></li>
                                <li><a href="../classes/Model.html">Model</a></li>
                                <li><a href="../classes/Mutable.html">Mutable</a></li>
                                <li><a href="../classes/Node.html">Node</a></li>
                                <li><a href="../classes/Perspective.html">Perspective</a></li>
                                <li><a href="../classes/perspective.html">perspective</a></li>
                                <li><a href="../classes/Point3.html">Point3</a></li>
                                <li><a href="../classes/PointLight.html">PointLight</a></li>
                                <li><a href="../classes/Renderer.html">Renderer</a></li>
                                <li><a href="../classes/RenderingContextUser.html">RenderingContextUser</a></li>
                                <li><a href="../classes/ShaderAttribLocation.html">ShaderAttribLocation</a></li>
                                <li><a href="../classes/ShaderAttribLocation..html">ShaderAttribLocation.</a></li>
                                <li><a href="../classes/ShaderProgram.html">ShaderProgram</a></li>
                                <li><a href="../classes/ShaderUniformLocation.html">ShaderUniformLocation</a></li>
                                <li><a href="../classes/ShaderVariableDecl.html">ShaderVariableDecl</a></li>
                                <li><a href="../classes/Spinor3.html">Spinor3</a></li>
                                <li><a href="../classes/Symbolic.html">Symbolic</a></li>
                                <li><a href="../classes/TreeModel.html">TreeModel</a></li>
                                <li><a href="../classes/UniformColor.html">UniformColor</a></li>
                                <li><a href="../classes/UniformFloat.html">UniformFloat</a></li>
                                <li><a href="../classes/UniformMetaInfo.html">UniformMetaInfo</a></li>
                                <li><a href="../classes/UniformMetaInfos.html">UniformMetaInfos</a></li>
                                <li><a href="../classes/UniformProvider.html">UniformProvider</a></li>
                                <li><a href="../classes/UniformSpinor3.html">UniformSpinor3</a></li>
                                <li><a href="../classes/UniformVariable.html">UniformVariable</a></li>
                                <li><a href="../classes/UniformVector3.html">UniformVector3</a></li>
                                <li><a href="../classes/Vector2.html">Vector2</a></li>
                                <li><a href="../classes/Vector3.html">Vector3</a></li>
                                <li><a href="../classes/View.html">View</a></li>
                                <li><a href="../classes/view.html">view</a></li>
                                <li><a href="../classes/WindowAnimationRunner.html">WindowAnimationRunner</a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/EIGHT.html">EIGHT</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: src/davinci-eight/uniforms/Node.ts</h1>

<div class="file">
    <pre class="code prettyprint linenums">
import Matrix3 = require(&#x27;../math/Matrix3&#x27;);
import Matrix4 = require(&#x27;../math/Matrix4&#x27;);
import TreeModel = require(&#x27;../uniforms/TreeModel&#x27;);
import Spinor3 = require(&#x27;../math/Spinor3&#x27;);
import Spinor3Coords = require(&#x27;../math/Spinor3Coords&#x27;);
import Symbolic = require(&#x27;../core/Symbolic&#x27;);
import UniformMetaInfos = require(&#x27;davinci-eight/core/UniformMetaInfos&#x27;);
import Vector3 = require(&#x27;../math/Vector3&#x27;);
import Color = require(&#x27;../core/Color&#x27;);
import Cartesian3 = require(&#x27;../math/Cartesian3&#x27;);
import UniformColor = require(&#x27;../uniforms/UniformColor&#x27;);

function localMatrix(scale: Cartesian3, attitude: Spinor3Coords, position: Cartesian3): Matrix4 {

  var S = Matrix4.identity();
  S.scaling(scale);

  var T = Matrix4.identity();
  T.translation(position);

  var R = Matrix4.identity();
  R.rotation(attitude);

  T.mul(R.mul(S));
  return T;
}

/**
 * @class Node
 * @extends TreeModel
 */
class Node extends TreeModel {
  /**
   * @property position
   * @type Vector3
   */
  public position: Vector3;
    /**
     * @property attitude
     * @type Spinor3Coords
     */
  public attitude: Spinor3;
  /**
   * @property position
   * @type Vector3
   */
  public scale: Vector3;
  /**
   *
   */
  private modelMatrixName: string;
  /**
   *
   */
  private normalMatrixName: string;
  /**
   *
   */
  private colorVarName: string;
  /**
   *
   */
  private uColor: UniformColor;
  /**
   * @class Model
   * @constructor
   */
  constructor(
    options?: {
      modelMatrixName?: string,
      normalMatrixName?: string,
      colorVarName?: string
    }) {
    super();
    options = options || {};
    this.modelMatrixName = options.modelMatrixName || Symbolic.UNIFORM_MODEL_MATRIX;
    this.normalMatrixName = options.normalMatrixName || Symbolic.UNIFORM_NORMAL_MATRIX;
    this.colorVarName = options.colorVarName || Symbolic.UNIFORM_COLOR;
    this.position = new Vector3();
    this.attitude = new Spinor3();
    this.scale = new Vector3([1, 1, 1]);
    this.uColor = new UniformColor(this.colorVarName, Symbolic.UNIFORM_COLOR);
  }
  get color(): Color {
    return this.uColor.data;
  }
  set color(color: Color) {
    this.uColor.data = color;
  }
  /**
   * @method getUniformVector3
   * @param name {string}
   */
  getUniformVector3(name: string) {
    //console.log(&quot;getUniformVector3(name=&#x27;&quot; + name + &quot;&#x27;)&quot;);
    switch(name) {
      case this.colorVarName: {
        if (this.uColor.data) {
          return this.uColor.getUniformVector3(name);
        }
        else if (this.getParent()) {
          return this.getParent().getUniformVector3(name);
        }
        else {
          return Color.fromRGB(1, 1, 1).data;
        }
      }
      break;
      default: {
        return super.getUniformVector3(name);
      }
    }
  }
  /**
   * @method getUniformMatrix3
   * @param name {string}
   */
  getUniformMatrix3(name: string): {transpose: boolean; matrix3: Float32Array} {
    switch(name) {
      case this.normalMatrixName: {
        // It&#x27;s unfortunate that we have to recompute the model-view matrix.
        // We could cache it, being careful that we don&#x27;t assume the callback order.
        // We don&#x27;t want to compute it in the shader beacause that would be per-vertex.
        var normalMatrix = Matrix3.identity();
        var mv = localMatrix(this.scale, this.attitude, this.position);
        normalMatrix.normalFromMatrix4(mv);
        // TODO: elements in Matrix3 should already be Float32Array
        return {transpose: false, matrix3: new Float32Array(normalMatrix.elements)};
      }
      break;
      default: {
        return super.getUniformMatrix3(name);
      }
    }
  }
  /**
   * @method getUniformMatrix4
   * @param name {string}
   */
  getUniformMatrix4(name: string): {transpose: boolean; matrix4: Float32Array} {
    switch(name) {
      case this.modelMatrixName: {
        if (this.getParent()) {
          var um4 = this.getParent().getUniformMatrix4(name);
          if (um4) {
            var m1 = new Matrix4(um4.matrix4);
            var m2 = localMatrix(this.scale, this.attitude, this.position);
            var m = Matrix4.identity().multiplyMatrices(m1, m2);
            return {transpose: false, matrix4: m.elements};
          }
          else {
            var m = localMatrix(this.scale, this.attitude, this.position);
            return {transpose: false, matrix4: m.elements};
          }
        }
        else {
          var m = localMatrix(this.scale, this.attitude, this.position);
          return {transpose: false, matrix4: m.elements};
        }
      }
      break;
      default: {
        return this.uColor.getUniformMatrix4(name);
      }
    }
  }
  /**
   * @method getUniformMeta
   */
  getUniformMeta(): UniformMetaInfos {
    var uniforms: UniformMetaInfos = this.uColor.getUniformMeta();
    uniforms[Symbolic.UNIFORM_MODEL_MATRIX]  = {name: this.modelMatrixName,  glslType: &#x27;mat4&#x27;};
    uniforms[Symbolic.UNIFORM_NORMAL_MATRIX] = {name: this.normalMatrixName, glslType: &#x27;mat3&#x27;};
    return uniforms;
  }
}

export = Node;

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
