<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src/davinci-eight/dfx/Simplex.ts - davinci-eight</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../../assets/logo.png" title="davinci-eight"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 2.97.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/ArrowBuilder.html">ArrowBuilder</a></li>
                                <li><a href="../classes/ArrowGeometry.html">ArrowGeometry</a></li>
                                <li><a href="../classes/ArrowOptions.html">ArrowOptions</a></li>
                                <li><a href="../classes/AttribDataInfos.html">AttribDataInfos</a></li>
                                <li><a href="../classes/AttribLocation.html">AttribLocation</a></li>
                                <li><a href="../classes/AttribMetaInfo.html">AttribMetaInfo</a></li>
                                <li><a href="../classes/AttribMetaInfos.html">AttribMetaInfos</a></li>
                                <li><a href="../classes/BarnGeometry.html">BarnGeometry</a></li>
                                <li><a href="../classes/BoxBuilder.html">BoxBuilder</a></li>
                                <li><a href="../classes/BoxComplex.html">BoxComplex</a></li>
                                <li><a href="../classes/BoxMesh.html">BoxMesh</a></li>
                                <li><a href="../classes/Cartesian1.html">Cartesian1</a></li>
                                <li><a href="../classes/Cartesian2.html">Cartesian2</a></li>
                                <li><a href="../classes/Cartesian3.html">Cartesian3</a></li>
                                <li><a href="../classes/Cartesian4.html">Cartesian4</a></li>
                                <li><a href="../classes/Color.html">Color</a></li>
                                <li><a href="../classes/Color
                WARNING: In many object-oriented designs, types representing values are completely immutable.
                In a graphics library where data changes rapidly and garbage collection might become an issue,
                it is common to use reference types, such as in this design. This mutability can lead to
                difficult bugs because it is hard to reason about where a color may have changed..html">Color
                WARNING: In many object-oriented designs, types representing values are completely immutable.
                In a graphics library where data changes rapidly and garbage collection might become an issue,
                it is common to use reference types, such as in this design. This mutability can lead to
                difficult bugs because it is hard to reason about where a color may have changed.</a></li>
                                <li><a href="../classes/Complex.html">Complex</a></li>
                                <li><a href="../classes/Complex
                Base class for complexes.
                A complex holds the faces and vertices (as simplices) used to describe a 3D mesh..html">Complex
                Base class for complexes.
                A complex holds the faces and vertices (as simplices) used to describe a 3D mesh.</a></li>
                                <li><a href="../classes/ContextListener.html">ContextListener</a></li>
                                <li><a href="../classes/CuboidMesh.html">CuboidMesh</a></li>
                                <li><a href="../classes/Curve.html">Curve</a></li>
                                <li><a href="../classes/CylinderArgs.html">CylinderArgs</a></li>
                                <li><a href="../classes/DodecahedronGeometry.html">DodecahedronGeometry</a></li>
                                <li><a href="../classes/DrawAttribute.html">DrawAttribute</a></li>
                                <li><a href="../classes/DrawElements.html">DrawElements</a></li>
                                <li><a href="../classes/ElementArray.html">ElementArray</a></li>
                                <li><a href="../classes/ElementBuffer.html">ElementBuffer</a></li>
                                <li><a href="../classes/EllipsoidMesh.html">EllipsoidMesh</a></li>
                                <li><a href="../classes/Face3.html">Face3</a></li>
                                <li><a href="../classes/Frustum.html">Frustum</a></li>
                                <li><a href="../classes/frustum.html">frustum</a></li>
                                <li><a href="../classes/Geometry.html">Geometry</a></li>
                                <li><a href="../classes/Geometry
                Base class for geometries.
                A complex holds the instructions for rendering a 3D mesh..html">Geometry
                Base class for geometries.
                A complex holds the instructions for rendering a 3D mesh.</a></li>
                                <li><a href="../classes/GeometryAdapter.html">GeometryAdapter</a></li>
                                <li><a href="../classes/HTMLScriptsMaterial.html">HTMLScriptsMaterial</a></li>
                                <li><a href="../classes/IcosahedronGeometry.html">IcosahedronGeometry</a></li>
                                <li><a href="../classes/KleinBottleGeometry.html">KleinBottleGeometry</a></li>
                                <li><a href="../classes/Line3.html">Line3</a></li>
                                <li><a href="../classes/Material.html">Material</a></li>
                                <li><a href="../classes/Matrix1.html">Matrix1</a></li>
                                <li><a href="../classes/Matrix2.html">Matrix2</a></li>
                                <li><a href="../classes/Matrix3.html">Matrix3</a></li>
                                <li><a href="../classes/Matrix4.html">Matrix4</a></li>
                                <li><a href="../classes/Matrix&lt;M&gt;.html">Matrix&lt;M&gt;</a></li>
                                <li><a href="../classes/Mesh.html">Mesh</a></li>
                                <li><a href="../classes/MeshNormalMaterial.html">MeshNormalMaterial</a></li>
                                <li><a href="../classes/MobiusStripGeometry.html">MobiusStripGeometry</a></li>
                                <li><a href="../classes/Model.html">Model</a></li>
                                <li><a href="../classes/Mutable.html">Mutable</a></li>
                                <li><a href="../classes/Object3D.html">Object3D</a></li>
                                <li><a href="../classes/OctahedronGeometry.html">OctahedronGeometry</a></li>
                                <li><a href="../classes/perspective.html">perspective</a></li>
                                <li><a href="../classes/Perspective.html">Perspective</a></li>
                                <li><a href="../classes/PerspectiveCamera.html">PerspectiveCamera</a></li>
                                <li><a href="../classes/Point3.html">Point3</a></li>
                                <li><a href="../classes/PolyhedronGeometry.html">PolyhedronGeometry</a></li>
                                <li><a href="../classes/Scene.html">Scene</a></li>
                                <li><a href="../classes/ShaderVariableDecl.html">ShaderVariableDecl</a></li>
                                <li><a href="../classes/Simplex.html">Simplex</a></li>
                                <li><a href="../classes/Simplex
                A simplex is the generalization of a triangle or tetrahedron to arbitrary dimensions.
                A k-simplex is the convex hull of its k + 1 vertices..html">Simplex
                A simplex is the generalization of a triangle or tetrahedron to arbitrary dimensions.
                A k-simplex is the convex hull of its k + 1 vertices.</a></li>
                                <li><a href="../classes/Sphere.html">Sphere</a></li>
                                <li><a href="../classes/SphereGeometry.html">SphereGeometry</a></li>
                                <li><a href="../classes/Spinor3.html">Spinor3</a></li>
                                <li><a href="../classes/SurfaceGeometry.html">SurfaceGeometry</a></li>
                                <li><a href="../classes/Symbolic.html">Symbolic</a></li>
                                <li><a href="../classes/Symbolic
                Canonical variable names, which also act as semantic identifiers for name overrides.
                These names must be stable to avoid breaking custom vertex and fragment shaders..html">Symbolic
                Canonical variable names, which also act as semantic identifiers for name overrides.
                These names must be stable to avoid breaking custom vertex and fragment shaders.</a></li>
                                <li><a href="../classes/TetrahedronGeometry.html">TetrahedronGeometry</a></li>
                                <li><a href="../classes/TubeGeometry.html">TubeGeometry</a></li>
                                <li><a href="../classes/UniformLocation.html">UniformLocation</a></li>
                                <li><a href="../classes/UniformMetaInfos.html">UniformMetaInfos</a></li>
                                <li><a href="../classes/UniformProvider.html">UniformProvider</a></li>
                                <li><a href="../classes/Vector1.html">Vector1</a></li>
                                <li><a href="../classes/Vector2.html">Vector2</a></li>
                                <li><a href="../classes/Vector3.html">Vector3</a></li>
                                <li><a href="../classes/Vector4.html">Vector4</a></li>
                                <li><a href="../classes/VectorN.html">VectorN</a></li>
                                <li><a href="../classes/Vertex.html">Vertex</a></li>
                                <li><a href="../classes/view.html">view</a></li>
                                <li><a href="../classes/View.html">View</a></li>
                                <li><a href="../classes/VortexGeometry.html">VortexGeometry</a></li>
                                <li><a href="../classes/WebGLRenderer.html">WebGLRenderer</a></li>
                                <li><a href="../classes/WindowAnimationRunner.html">WindowAnimationRunner</a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/EIGHT.html">EIGHT</a></li>
                                <li><a href="../modules/THREE.html">THREE</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: src/davinci-eight/dfx/Simplex.ts</h1>

<div class="file">
    <pre class="code prettyprint linenums">
import expectArg = require(&#x27;../checks/expectArg&#x27;);
import isInteger = require(&#x27;../checks/isInteger&#x27;);
import isNumber = require(&#x27;../checks/isNumber&#x27;);
import Vertex = require(&#x27;../dfx/Vertex&#x27;);
import VertexAttributeMap = require(&#x27;../dfx/VertexAttributeMap&#x27;);
import VectorN = require(&#x27;../math/VectorN&#x27;);

// TODO; Make this checkIntegerArg with a range.
function checkIntegerArg(name: string, n: number, min: number, max: number): number {
  if (isInteger(n) &amp;&amp; n &gt;= min &amp;&amp; n &lt;= max) {
    return n;
  }
  // TODO: I don&#x27;t suppose we can go backwards with a negative count? Hmmm...
  // expectArg(name, n).toBeInClosedInterval(min, max);
  expectArg(name, n).toSatisfy(false, name + &quot; must be an integer in the range [&quot; + min + &quot;,&quot; + max + &quot;]&quot;);
}
function checkCountArg(count: number) {
  // TODO: The count range should depend upon the k value of the simplex.
  return checkIntegerArg(&#x27;count&#x27;, count, 0, 7);
}

function concatReduce(a: Simplex[], b: Simplex[]): Simplex[] {
  return a.concat(b);
}

function expectArgVectorN(name: string, vector: VectorN&lt;number&gt;): VectorN&lt;number&gt; {
  return expectArg(name, vector).toSatisfy(vector instanceof VectorN, name + &#x27; must be a VectorN&#x27;).value;
}

function lerp(a: number[], b: number[], alpha: number, data: number[] = []): number[] {
  expectArg(&#x27;b&#x27;, b).toSatisfy(a.length === b.length, &quot;a must be the same length as b&quot;);
  let dims = a.length;
  var i: number;
  let beta = 1 - alpha;
  for (i = 0; i &lt; dims; i++) {
    data.push(beta * a[i] + alpha * b[i]);
  }
  return data;
}

function lerpVertexAttributeMap(a: VertexAttributeMap, b: VertexAttributeMap, alpha: number): VertexAttributeMap {

  let attribMap: VertexAttributeMap = {};

  let keys = Object.keys(a);
  let keysLength = keys.length;
  for (var k = 0; k &lt; keysLength;k++) {
    let key = keys[k];
    attribMap[key] = lerpVectorN(a[key], b[key], alpha);
  }
  return attribMap;
}
// TODO: Looks like a static of VectorN or a common function.
function lerpVectorN(a: VectorN&lt;number&gt;, b: VectorN&lt;number&gt;, alpha: number): VectorN&lt;number&gt; {
  return new VectorN&lt;number&gt;(lerp(a.data, b.data, alpha));
}

/**
 * A simplex is the generalization of a triangle or tetrahedron to arbitrary dimensions.
 * A k-simplex is the convex hull of its k + 1 vertices.
 */
class Simplex {
  // TODO: Could use a VectorN&lt;Vertex here?&gt;
  public vertices: Vertex[] = [];
  /**
   * @class Simplex
   * @constructor
   * @param k {number} The initial number of vertices in the simplex is k + 1.
   */
  constructor(k: number) {
    if (!isInteger(k)) {
      expectArg(&#x27;k&#x27;, k).toBeNumber();
    }
    let numVertices: number = k + 1;
    for (var i = 0; i &lt; numVertices; i++) {
      this.vertices.push(new Vertex());
    }
    let parent = this;
    this.vertices.forEach(function(vertex) {
      vertex.parent = parent;
    });
  }
  get k(): number {
    return this.vertices.length - 1;
  }
  // These symbolic constants represent the correct k values for various low-dimesional simplices. 
  // The number of vertices in a k-simplex is k + 1.
  /**
   * An empty set can be consired to be a -1 simplex (algebraic topology).
   */
  public static K_FOR_EMPTY = -1;
  /**
   * A single point may be considered a 0-simplex.
   */
  public static K_FOR_POINT = 0;
  /**
   * A line segment may be considered a 1-simplex.
   */
  public static K_FOR_LINE_SEGMENT = 1;
  /**
   * A 2-simplex is a triangle.
   */
  public static K_FOR_TRIANGLE = 2;
  /**
   * A 3-simplex is a tetrahedron.
   */
  public static K_FOR_TETRAHEDRON = 3;
  /**
   * A 4-simplex is a 5-cell.
   */
  public static K_FOR_FIVE_CELL = 4;
  /**
   *
   */
  public static indices(simplex: Simplex): number[] {
    return simplex.vertices.map(function(vertex) { return vertex.index; });
  }
  /**
   * Computes the boundary of the simplex.
   */
  private static boundaryMap(simplex: Simplex): Simplex[] {
    let vertices = simplex.vertices;
    let k = simplex.k;
    if (k === Simplex.K_FOR_TRIANGLE) {
      var line01 = new Simplex(k - 1);
      line01.vertices[0].parent = line01;
      line01.vertices[0].attributes = simplex.vertices[0].attributes;
      line01.vertices[1].parent = line01;
      line01.vertices[1].attributes = simplex.vertices[1].attributes;

      var line12 = new Simplex(k - 1);
      line12.vertices[0].parent = line12;
      line12.vertices[0].attributes = simplex.vertices[1].attributes;
      line12.vertices[1].parent = line12;
      line12.vertices[1].attributes = simplex.vertices[2].attributes;

      var line20 = new Simplex(k - 1);
      line20.vertices[0].parent = line20;
      line20.vertices[0].attributes = simplex.vertices[2].attributes;
      line20.vertices[1].parent = line20;
      line20.vertices[1].attributes = simplex.vertices[0].attributes;
      return [line01, line12, line20];
    }
    else if (k === Simplex.K_FOR_LINE_SEGMENT) {
      var point0 = new Simplex(k - 1);
      point0.vertices[0].parent = point0;
      point0.vertices[0].attributes = simplex.vertices[0].attributes;

      var point1 = new Simplex(k - 1);
      point1.vertices[0].parent = point1;
      point1.vertices[0].attributes = simplex.vertices[1].attributes;
      return [point0, point1];
    }
    else if (k === Simplex.K_FOR_POINT) {
      // For consistency, we get one empty simplex rather than an empty list.
      return [new Simplex(k - 1)];
    }
    else if (k === Simplex.K_FOR_EMPTY) {
      return [];
    }
    else {
      // TODO: Handle the TETRAHEDRON and general cases.
      throw new Error(&quot;Unexpected k-simplex, k = &quot; + simplex.k + &quot; @ Simplex.boundaryMap()&quot;);
    }
  }
  private static subdivideMap(simplex: Simplex): Simplex[] {
    expectArg(&#x27;simplex&#x27;, simplex).toBeObject();
    let divs: Simplex[] = [];
    let vertices = simplex.vertices;
    let k = simplex.k;
    if (k === Simplex.K_FOR_TRIANGLE) {
      let a = vertices[0].attributes;
      let b = vertices[1].attributes;
      let c = vertices[2].attributes;

      let m1 = lerpVertexAttributeMap(a, b, 0.5)
      let m2 = lerpVertexAttributeMap(b, c, 0.5)
      let m3 = lerpVertexAttributeMap(c, a, 0.5)

      let face1 = new Simplex(k);
      face1.vertices[0].attributes = c;
      face1.vertices[1].attributes = m3;
      face1.vertices[2].attributes = m2;
      let face2 = new Simplex(k);
      face2.vertices[0].attributes = a;
      face2.vertices[1].attributes = m1;
      face2.vertices[2].attributes = m3;
      let face3 = new Simplex(k);
      face3.vertices[0].attributes = b;
      face3.vertices[1].attributes = m2;
      face3.vertices[2].attributes = m1;
      let face4 = new Simplex(k);
      face4.vertices[0].attributes = m1;
      face4.vertices[1].attributes = m2;
      face4.vertices[2].attributes = m3;

      divs.push(face1);
      divs.push(face2);
      divs.push(face3);
      divs.push(face4);
    }
    else if (k === Simplex.K_FOR_LINE_SEGMENT) {
      let a = vertices[0].attributes;
      let b = vertices[1].attributes;

      let m = lerpVertexAttributeMap(a, b, 0.5)

      let line1 = new Simplex(k);
      line1.vertices[0].attributes = a;
      line1.vertices[1].attributes = m;
      let line2 = new Simplex(k);
      line2.vertices[0].attributes = m;
      line2.vertices[1].attributes = b;

      divs.push(line1);
      divs.push(line2);
    }
    else if (k === Simplex.K_FOR_POINT) {
      divs.push(simplex);
    }
    else if (k === Simplex.K_FOR_EMPTY) {
      // Ignore, don&#x27;t push is the generalization.
    }
    else {
      throw new Error(k + &quot;-simplex is not supported&quot;);
    }

    return divs;
  }
  public static boundary(geometry: Simplex[], count: number = 1): Simplex[] {
    checkCountArg(count);
    for (var i = 0; i &lt; count; i++) {
      geometry = geometry.map(Simplex.boundaryMap).reduce(concatReduce, []);
    }
    return geometry;
  }
  public static subdivide(geometry: Simplex[], count: number = 1): Simplex[] {
    checkCountArg(count);
    for (var i = 0; i &lt; count; i++) {
      geometry = geometry.map(Simplex.subdivideMap).reduce(concatReduce, []);
    }
    return geometry;
  }
  // TODO: This function destined to be part of Simplex constructor.
  public static setAttributeValues(attributes: {[name: string]: VectorN&lt;number&gt;[]}, simplex: Simplex) {
    let names: string[] = Object.keys(attributes);
    let attribsLength = names.length;
    let attribIndex;
    for (attribIndex = 0; attribIndex &lt; attribsLength; attribIndex++) {
      let name = names[attribIndex];
      let values: VectorN&lt;number&gt;[] = attributes[name];
      let valuesLength = values.length;
      let valueIndex;
      for (valueIndex = 0; valueIndex &lt; valuesLength; valueIndex++) {
        simplex.vertices[valueIndex].attributes[name] = values[valueIndex];
      }
    }
  }
}

export = Simplex;
    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
